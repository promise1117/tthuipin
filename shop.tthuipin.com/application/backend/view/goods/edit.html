{include file="./public/head" /}
<style type="text/css">
    .layui-form-label{
        width: 90px;
        font-size: 13px;
        font-weight: 600;
        text-align: left;
    }
    .layui-input-block {
        margin-left: 120px;
        min-height: 36px;
    }
</style>
<script src="http://libs.baidu.com/jquery/1.7.2/jquery.js"></script>
<body>
<div class="layui-fluid">
    <div class="layui-row">
        <form class="layui-form" id="LAY-component-form-setval" lay-filter="example">

            <div class="layui-form-item">

                <label for="username" class="layui-form-label">
                    <span class="x-red">*</span>主产品编号
                </label>
                <div class="layui-input-block">
                    <input type="hidden" id="userid" name="userid" value="{$info.userid}" readonly lay-verify="required"
                           autocomplete="off" class="layui-input">
                    <input type="text" id="goods_no" name="goods_no" value="{$info.goods_no}" readonly lay-verify="required"
                           autocomplete="off" class="layui-input" placeholder="请输入主产品编号">
                    <input type="hidden" id="id" name="id" value="{$info.id}">
                </div>

            </div>
            <div class="layui-form-item">

                <label for="username" class="layui-form-label">
                    <span class="x-red">*</span>主产品名称
                </label>
                <div class="layui-input-block">
                    <input type="text" id="name" name="name" value="{$info.name}" required="" lay-verify="required"
                           autocomplete="off" class="layui-input" placeholder="请输入主产品名称">
                    <!-- <input type="text" id="title" name="title" value="{$info.title}" required="" lay-verify="required"
                           autocomplete="off" class="layui-input"> -->
                </div>

            </div>


            <div class="layui-form-item" style="display:none;">

                <label for="custom_name" class="layui-form-label">
                    <span class="x-red">*</span>自定义名称
                </label>
                <div class="layui-input-inline">
                    <input type="text" id="custom_name" name="custom_name" value="{$info.custom_name}"
                           autocomplete="off" class="layui-input">
                    <!-- <input type="text" id="title" name="title" value="{$info.title}" required="" lay-verify="required"
                           autocomplete="off" class="layui-input"> -->
                </div>
                <div class="layui-form-mid layui-word-aux">
                    <span class="x-red">*</span>自定义产品名称<!-- <br />
                    <span class="x-red">*</span>顶部标题 -->
                </div>
            </div>
            <div class="layui-form-item">
                <label for="content" class="layui-form-label">
                    <span class="x-red">*</span>关键词
                </label>
                <div class="layui-input-block">
                    <!--                        <textarea placeholder="请输入商品关键词" class="layui-textarea" name="keywords">{$info.keywords}</textarea>-->
                    <input type="text" id="" name="keywords" value="{$info.keywords}" placeholder="请输入商品关键词" autocomplete="off" class="layui-input">
                </div>
<!--                <div class="layui-form-mid layui-word-aux">-->
<!--                    <span class="x-red">*</span>换行加英文状态的‘,’ 逗号，最多六行，最后一行不加符号-->
<!--                </div>-->
            </div>
            <div class="layui-form-item">
                <label for="content" class="layui-form-label">
                    <span class="x-red">*</span>进货链接
                </label>
                <div class="layui-input-block">
                    <!--                        <textarea placeholder="请输入商品进货链接" class="layui-textarea" name="search_words">{$info.search_words}</textarea>-->
                    <input type="text" id="" name="search_words" value="{$info.search_words}" placeholder="请输入商品的进货链接" autocomplete="off" class="layui-input">

                </div>

            </div>
            <div class="layui-form-item">
                <label for="content" class="layui-form-label">
                    <span class="x-red">*</span>推荐语
                </label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入产品推荐语字数不限" class="layui-textarea" name="content">{$info.content}</textarea>
                </div>

            </div>
            <div class="layui-form-item" style="display: none">
                <label for="content" class="layui-form-label">
                    <span class="x-red">*</span>猜你喜欢
                </label>
                <div class="layui-form-item layui-form-text">
                    <div class="layui-input-block">
                        <textarea placeholder="请输入商品id" class="layui-textarea" name="like">{$info.like}</textarea>
                    </div>
                </div>
                <div class="layui-form-mid layui-word-aux">
                    <span class="x-red">*</span>喜欢的产品id，以英文的‘,’逗号分隔
                </div>
            </div>
            <div class="layui-form-item">
                <label for="username" class="layui-form-label">
                    <span class="x-red">*</span>主产品展示图
                </label>
                <div class="layui-input-inline">
                    <input type="hidden" id="headimg" name="filedan" value="{$info.img}" required="" autocomplete="off" class="layui-input">
                    <div class="layui-upload">
                        <button type="button" class="layui-btn" id="test1">上传图片</button>
                        <div class="layui-upload-list">
                            <img class="layui-upload-img" id="demo1" src="{$info.img}" width="120px" height="120px">
                            <p id="demoText"></p>
                        </div>
                    </div>
                </div>
                <div class="layui-form-mid layui-word-aux" style="margin-left: -100px;">
                    <span class="x-red">*</span>主产品展示图（建议尺寸：400*400px；单张）
                </div>
            </div>
            <div class="layui-form-item">
                <label for="username" class="layui-form-label">
                    <span class="x-red">*</span>详情页banner图
                </label>
                <div class="layui-upload">

                    <button type="button" class="layui-btn layui-btn-normal" id="testListb"  style="float: left;">请选择图片/视频</button>
                    <div class="layui-form-mid layui-word-aux" style="margin-left: 10px;">
                        <span class="x-red">*</span>详情页banner图片/视频 支持jpg/gif/png/mp4格式（建议尺寸：400*400px；多张）
                    </div>
                    <button type="button" class="layui-btn" id="testListActionb" style="float: right;margin-right:12px;" >开始上传</button>
                    <span class="num_picb" style="float: right;margin: 8px;"></span>

                    <div class="layui-upload-list">
                        <table class="layui-table">
                            <thead>
                            <tr>
                                <th>文件名</th>
                                <th id="picb">图片预览</th>
                                <th>大小</th>
                                <th>状态</th>
                                <th id="caob">操作</th>
                                <th>
                                    <div class="layui-btn-group">
                                        <button type="button"  class="layui-btn layui-btn-sm checkAll">
                                            全选
                                        </button>
                                        <button type="button" class="layui-btn layui-btn-sm cancelAll">
                                            全部取消
                                        </button>
                                        <button type="button" class="layui-btn layui-btn-sm layui-btn-danger deleteAll">
                                            <i class="layui-icon">&#xe640;</i>
                                        </button>

                                    </div>
                                </th>
                            </tr>
                            <!--http://www.thinkphpshop.cn/uploads/20191028\e1ed53819ba10da945a44b57bb55259c.jpg-->
                            {volist name="info['bimg']" id="vv"}
                            <tr class="deleteimgremove{$key+1}">
                                <th>{php} echo substr($vv,-36){/php}</th>
                                <th id="picb">
                                    {php}$reg = preg_match('/mp4/i',$vvv);{/php}
                                    {if !$reg}
                                    <img id="deleteimgbanner{$key+1}" src="{$vv}" onload="getimagesize{$i}(this.src)" onclick="del{$i}(this.src)">
                                    {else /}
                                    <video  onclick="del{$i}(this.src)" controls style="width: 100px;height: 100px;"><source src="{$vv}" type="video/mp4"></video>
                                    {/if}
                                </th>
                                <th id="filesize{$key+1}">
                                </th>
                                <th>已上传</th>
                                <!--<th id="caob"><button type="button" id="deleteImageb{$key+1}">删除</button></th>-->
                                <th id="caob">点击图片删除</th>
                                <th>
                                    <input type="checkbox" class="checkbox" lay-skin="primary" data-src="{$vv}" data-key="deleteimgremove{$key+1}">
                                </th>
                            </tr>
                            <input type="hidden" class="deleteimgremove{$key+1}" name="filesb[]" value="{$vv}" >
                            <script>
                                //图片的大小kb
                                function getimagesize{$i}(obj){
                                    $.ajax({
                                        type:'post',
                                        url:'/vimgsize',
                                        data:{imgsize:obj},
                                        success:function(data){
                                            if(data.code == 200){
                                                // var num = data.data/1024;
                                                //  num = num.toFixed(2);//保留两位小数，四舍五入
                                                //console.log(num);
                                                $("#filesize{$key+1}").text(data.data+' kb');
                                            }
                                        },
                                        error:function(){
                                            console.log('异常数据！！');
                                        }
                                    })
                                }
                                //图片删除
                                function del{$i}(obj){
                                    if(confirm('确定要删除吗')){
                                        $.ajax({
                                            type:'POST',
                                            url:'/vdeleteimg',
                                            data:{dir:obj},
                                            success:function(data){
                                                // console.log(data);return ;
                                                if(data.code = 200){
                                                    $(".deleteimgremove{$key+1}").remove();
                                                    $(".deleteimgremove{$key+1}").val('');
                                                    alert('删除成功');
                                                }else{
                                                    console.log(data.message);
                                                }
                                            },
                                            erroe:function () {
                                                alert('异常!!');
                                            }
                                        })
                                    }
                                }
                            </script>
                            {/volist}
                            </thead>
                            <tbody id="demoListb"></tbody>
                        </table>
                    </div>

                </div>

            </div>
            <div class="layui-form-item">
                <label for="username" class="layui-form-label">
                    <span class="x-red">*</span>主产品详情图
                </label>
                <div class="layui-upload">

                    <button type="button" class="layui-btn layui-btn-normal" id="testList" style="float: left;">请选择图片/视频</button>
                    <div class="layui-form-mid layui-word-aux" style="margin-left: 10px;">
                        <span class="x-red">*</span>产品介绍详情图片/视频 支持jpg/gif/png/mp4格式，多张（宽≥750px，高度不限）
                    </div>
                    <button type="button" class="layui-btn" id="testListAction" style="float: right;margin-right:12px;">开始上传</button>
                    <span class="num_pic" style="float: right;margin: 8px;"></span>

                    <div class="layui-upload-list">
                        <table class="layui-table">
                            <thead>
                            <tr>
                                <th>文件名</th>
                                <th id="pic">图片预览</th>
                                <th>大小</th>
                                <th>状态</th>
                                <th id="cao">操作</th>
                                <th>
                                    <div class="layui-btn-group">
                                        <button type="button"  class="layui-btn layui-btn-sm checkAll">
                                            全选
                                        </button>
                                        <button type="button" class="layui-btn layui-btn-sm cancelAll">
                                            全部取消
                                        </button>
                                        <button type="button" class="layui-btn layui-btn-sm layui-btn-danger deleteAll">
                                            <i class="layui-icon">&#xe640;</i>
                                        </button>

                                    </div>
                                </th>
                            </tr>
                            <!--http://www.thinkphpshop.cn/uploads/20191028\e1ed53819ba10da945a44b57bb55259c.jpg-->
                            {volist name="info['iimg']" id="vvv"}
                            <tr class="deleteimgremovex{$key+1}">
                                <th>{php} echo substr($vvv,-36){/php}</th>
                                <th id="pic">
                                    {php}$reg = preg_match('/mp4/i',$vvv);{/php}
                                    {if !$reg}
                                    <img id="deleteimgbannerx{$key+1}" src="{$vvv}" onload="getimagesizex{$i}(this.src)" onclick="delx{$i}(this.src)">
                                    {else /}
                                    <video  onclick="delx{$i}(this.src)" controls style="width: 100px;height: 100px;"><source src="{$vvv}" type="video/mp4"></video>
                                    {/if}
                                </th>
                                <th id="filesizex{$key+1}">
                                </th>
                                <th>已上传</th>
                                <!--<th id="caob"><button type="button" id="deleteImageb{$key+1}">删除</button></th>-->
                                <th id="cao">点击图片删除</th>
                                <th>
                                    <input type="checkbox" class="checkbox" lay-skin="primary" data-src="{$vvv}" data-key="deleteimgremovex{$key+1}">
                                </th>
                            </tr>
                            <input type="hidden" class="deleteimgremovex{$key+1}" name="files[]" value="{$vvv}" >
                            <script>
                                //图片的大小kb
                                function getimagesizex{$i}(obj){
                                    $.ajax({
                                        type:'post',
                                        url:'/vimgsize',
                                        data:{imgsize:obj},
                                        success:function(data){
                                            if(data.code == 200){
                                                // var num = data.data/1024;
                                                //  num = num.toFixed(2);//保留两位小数，四舍五入
                                                //console.log(num);
                                                $("#filesizex{$key+1}").text(data.data+' kb');
                                            }
                                        },
                                        error:function(){
                                            console.log('异常数据！！');
                                        }
                                    })
                                }
                                //图片删除
                                function delx{$i}(obj){
                                    if(confirm('确定要删除吗')){
                                        $.ajax({
                                            type:'POST',
                                            url:'/vdeleteimg',
                                            data:{dir:obj},
                                            success:function(data){
                                                // console.log(data);return ;
                                                if(data.code = 200){
                                                    $(".deleteimgremovex{$key+1}").remove();
                                                    $(".deleteimgremovex{$key+1}").val('');
                                                    alert('删除成功');
                                                }else{
                                                    console.log(data.message);
                                                }
                                            },
                                            erroe:function () {
                                                alert('异常!!');
                                            }
                                        })
                                    }
                                }
                            </script>
                            {/volist}
                            </thead>
                            <tbody id="demoList"></tbody>
                        </table>
                    </div>

                </div>

            </div>
            <div class="layui-form-item">
                <label for="uptime" class="layui-form-label">
                    <span class="x-red">*</span>产品日期
                </label>
                <div class="layui-inline">
                    <div class="layui-input-inline" title="上架日期">
                        <input type="text" class="layui-input" id="test11" name="up_time" value="{$info['up_time']|date='Y-m-d'}" placeholder="yyyy年MM月dd日">
                        <svg style="position: absolute; top: 6%; right: 2%;z-index: 0;" t="1591607679625" class="icon" viewBox="0 0 1024 1024"
                             version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="25638" width="30" height="30">
                            <path d="M512 1024A512 512 0 1 1 512 0a512 512 0 0 1 0 1024z m0-78.774857A433.225143 433.225143 0 1 0 512 78.774857a433.225143 433.225143 0 0 0 0 866.450286z m0-393.874286h236.251429a39.424 39.424 0 0 1 0 78.774857H472.649143a39.350857 39.350857 0 0 1-39.350857-39.350857V236.251429A39.350857 39.350857 0 1 1 512 236.251429v315.026285z"
                                  p-id="25639" fill="#707070"></path>
                        </svg>
                    </div>
                    <div class="layui-form-mid layui-word-aux">
                        ——
                    </div>
                    <div class="layui-input-inline" title="下架日期">
                        <input type="text" class="layui-input" id="test12" name="down_time" value="{$info['down_time']|date='Y-m-d'}" placeholder="yyyy年MM月dd日">
                        <svg style="position: absolute; top: 6%; right: 2%;z-index: 0;" t="1591607679625" class="icon" viewBox="0 0 1024 1024"
                             version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="25638" width="30" height="30">
                            <path d="M512 1024A512 512 0 1 1 512 0a512 512 0 0 1 0 1024z m0-78.774857A433.225143 433.225143 0 1 0 512 78.774857a433.225143 433.225143 0 0 0 0 866.450286z m0-393.874286h236.251429a39.424 39.424 0 0 1 0 78.774857H472.649143a39.350857 39.350857 0 0 1-39.350857-39.350857V236.251429A39.350857 39.350857 0 1 1 512 236.251429v315.026285z"
                                  p-id="25639" fill="#707070"></path>
                        </svg>
                    </div>

                </div>

            </div>
            <!--    <div class="layui-form-item">
                    <label for="username" class="layui-form-label">
                        <span class="x-red">*</span>价格
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="sell_price" name="sell_price" value="{$info.sell_price}" autocomplete="off" class="layui-input">
                        <input type="text" id="market_price" name="market_price" value="{$info.market_price}" autocomplete="off" class="layui-input">
                        &lt;!&ndash;<input type="text" id="cost_price" name="cost_price" autocomplete="off" class="layui-input">&ndash;&gt;
                    </div>
                    <div class="layui-form-mid layui-word-aux">
                        <span class="x-red">*</span>销售价(NT$)<br />
                        <span class="x-red">*</span>市场价(NT$)
                        &lt;!&ndash;<span class="x-red">*</span>成本价(NT$)&ndash;&gt;
                    </div>
                </div>-->
            <div class="layui-form-item df">
                <div class="layui-form-item">
                    <label for="username" class="layui-form-label">
                        <span class="x-red">*</span>销售价(NT$)
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="sell_price" name="sell_price" value="{$info.sell_price}" autocomplete="off" class="layui-input"
                               placeholder="请输入售价">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label for="username" class="layui-form-label">
                        <span class="x-red">*</span>市场价(NT$)
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="market_price" name="market_price" value="{$info.market_price}" autocomplete="off" class="layui-input"
                               placeholder="请输入原价">
                    </div>
                </div>
            </div>
            <!--
                        <div class="layui-form-item">

                            <label for="store_nums" class="layui-form-label">
                                <span class="x-red">*</span>数量
                            </label>
                            <div class="layui-input-inline">
                                <input type="text" id="store_nums" name="store_nums" value="{$info['store_nums']}"  autocomplete="off" class="layui-input">
                                <input type="text" id="sale" name="sale" value="{$info['sale']}" autocomplete="off" class="layui-input">
                                <input type="text" id="visit" name="visit" value="{$info['visit']}" autocomplete="off" class="layui-input">
                            </div>
                            <div class="layui-form-mid layui-word-aux">
                                <span class="x-red">*</span>库存数量<br />
                                <span class="x-red">*</span>销量<br />
                                <span class="x-red">*</span>浏览量
                            </div>
                        </div>
            -->
            <div class="layui-form-item df">
                <div class="layui-form-item">
                    <label for="store_nums" class="layui-form-label">
                        <span class="x-red">*</span>库存数量
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="store_nums" name="store_nums" value="{$info['store_nums']}" autocomplete="off" class="layui-input"
                               placeholder="请输入库存数量">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label for="store_nums" class="layui-form-label">
                        <span class="x-red">*</span>产品销量
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="sale" name="sale" value="{$info['sale']}" autocomplete="off" class="layui-input" placeholder="请输入产品销量">
                    </div>
                </div>
            </div>

            <!--
                        <div class="layui-form-item">

                            <label for="username" class="layui-form-label">
                                <span class="x-red">*</span>排序
                            </label>
                            <div class="layui-input-inline">
                                <input type="text" id="sort" name="sort" value="{$info['sort']}" autocomplete="off" class="layui-input">
                            </div>
                            <div class="layui-form-mid layui-word-aux">
                                <span class="x-red">*</span>数字越大，越往前
                            </div>
                        </div>
            -->

            <div class="layui-form-item df">
                <div class="layui-form-item">
                    <label for="store_nums" class="layui-form-label">
                        <span class="x-red">*</span>产品浏览量
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="visit" name="visit" value="{$info['visit']}" autocomplete="off" class="layui-input" placeholder="请输入产品浏览量">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label for="username" class="layui-form-label">
                        <span class="x-red">*</span>产品排序
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="sort" name="sort" value="{$info['sort']}" autocomplete="off" class="layui-input" placeholder="数字越大越往前">
                    </div>
                </div>

            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">支持条件</label>
                <div class="layui-input-block">
                    {php}
                    $param = explode(',',$info['onoff']);
                    $sheng = [1,2,3,4];
                    $diffs = array_diff($sheng,$param);
                    {/php}
                    {volist name="param" id="vo"}
                    {switch $vo}
                    {case 1}<input type="checkbox" name="nooff[]" value="1" title="免运费" checked="">{/case}
                    {case 2}<input type="checkbox" name="nooff[]" value="2" title="七天鉴赏期" checked="">{/case}
                    {case 3}<input type="checkbox" name="nooff[]" value="3" title="支持711商家取货" checked="">{/case}
                    {case 4}<input type="checkbox" name="nooff[]" value="4" title=" 支持全家取貨" checked="">{/case}
                    {/switch}
                    {/volist}
                    {volist name="diffs" id="vo"}
                    {switch $vo}
                    {case 1}<input type="checkbox" name="nooff[]" value="1" title="免运费" >{/case}
                    {case 2}<input type="checkbox" name="nooff[]" value="2" title="七天鉴赏期" >{/case}
                    {case 3}<input type="checkbox" name="nooff[]" value="3" title="支持711商家取货" >{/case}
                    {case 4}<input type="checkbox" name="nooff[]" value="4" title=" 支持全家取貨" >{/case}
                    {/switch}
                    {/volist}
                    <!--<input type="checkbox" name="nooff[0]" value="1" title="免运费" checked="">-->
                    <!--<input type="checkbox" name="nooff[0]" value="2" title="七天鉴赏期" checked="">-->
                    <!--<input type="checkbox" name="nooff[0]" value="3" title="支持711商家取货" checked="">-->
                    <!--<input type="checkbox" name="nooff[0]" value="4" title=" 支持全家取貨" checked="">-->
                </div>
            </div>


            <div class="layui-form-item">
                <label class="layui-form-label">是否新品</label>
                <div class="layui-input-block">
                    <input type="radio" name="new" value="0" title="非新品" {if $info.new=="0"} checked=""{/if}>
                    <input type="radio" name="new" value="1" title="新品" {if $info.new=="1"} checked=""{/if}>

                </div>
            </div>






            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">所属分类</label>
                    <div class="layui-input-inline">
                        <select name="categoryid">
                            <option value="0">请选择主产品所属分类</option>
                            {volist name="categorylsit" id="v"}
                            <optgroup label="{$v.cat_name}"></optgroup>
                            <!--<option value="{$v.cat_id}">{$v.cat_name}</option>-->
                            {volist name="elist" id="vv"}
                            {if $v.cat_id == $vv.parent_id}
                            <option value="{$vv.cat_id}" {if $info.categoryid == $vv.cat_id} selected {/if}>——{$vv.cat_name}</option>
                            {/if}
                            {/volist}
                            {/volist}
                        </select>
                    </div>
                    <div class="layui-form-mid layui-word-aux">
                        <span class="x-red">*</span>默认一级分类
                    </div>
                </div>
            </div>

            <div class="layui-form-item">
                <label for="L_repass" class="layui-form-label"> </label>
                <button  class="layui-btn  layui-btn-lg" lay-filter="add" lay-submit="" style="width: 120px; margin-left: 6%;">
                    提交
                </button>
            </div>
        </form>
    </div>
</div>
<script>
    layui.use('laydate', function() {
        var laydate = layui.laydate;
        laydate.render({
            elem: '#test11'
            , format: 'yyyy-MM-dd'
        });
        laydate.render({
            elem: '#test12'
            , format: 'yyyy-MM-dd'
        });
    });
    layui.use(['form', 'layer'],
        function() {
            $ = layui.jquery;
            var form = layui.form,
                layer = layui.layer;

            //监听提交
            form.on('submit(add)',
                function(data) {
                    // console.log(data.field);return ;
                    //发异步，把数据提交给php
                    $.ajax({
                        url:'/vgoodsedit',
                        type:'post',
                        data:data.field,
                        success:function(data) {
                            // console.log(data);return;
                            if(data.code =="200" ){
                                // console.log(data.data);return ;
                                // view("添加成功！");
                                layer.alert("修改成功", {
                                        icon: 6
                                    },
                                    function() {
                                        //关闭当前frame
                                        xadmin.close();

                                        // 可以对父窗口进行刷新
                                        xadmin.father_reload();
                                    });
                                // window.location.reload();

                            }else{
                                alert(data.message);
                                // view(data.msg);
                            }
                        },
                        error : function() {
                            // view("异常！");
                            alert("异常！");
                        }
                    });
                    return false;
                });

        });
</script>
<script>
    layui.use('upload', function(){
        var $ = layui.jquery
            ,upload = layui.upload;

        //普通图片上传
        var uploadInst = upload.render({
            elem: '#test1'
            ,url: '/vupload'
            ,before: function(obj){
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result){
                    $('#demo1').attr('src', result); //图片链接（base64）
                });
            }
            ,done: function(res){
                if(res.code == 200){
                    $('#headimg').val(res.data);
                }
                // console.log(res.data);
                // return ;
                //如果上传失败
                if(res.code == 100){
                    return layer.msg('上传失败');
                }
                //上传成功
            }
            ,error: function(){
                //演示失败状态，并实现重传
                var demoText = $('#demoText');
                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                demoText.find('.demo-reload').on('click', function(){
                    uploadInst.upload();
                });
            }
        });
    });
</script>
<script type="text/javascript">
    layui.use('upload', function() {
        var $ = layui.jquery,
            upload = layui.upload;
        //多文件列表示例
        var demoListView = $('#demoList'),
            uploadListIns = upload.render({
                elem: '#testList',
                url: "/vuploads",
                accept: 'file',
                // acceptMime: 'image/*',
                size: 81920,
                multiple: true,
                number: 400,
                auto: false,
                // exts: 'jpg|png|jpeg|gif',
                bindAction: '#testListAction',
                choose: function(obj) {
                    var files = this.files = obj.pushFile(); //将每次选择的文件追加到文件队列
                    //读取本地文件
                    obj.preview(function(index, file, result) {
                        var is_image = /jpg|png|jpeg|gif/.test(file.name.substring(file.name.indexOf('.')+1));
                        if(is_image){
                            var tr = $(['<tr id="upload-' + index + '">', '<td>' + file.name + '</td>', '<td><img src="' + result + '" alt="' + file.name + '" style="width: 100px;height: 100px;"></td>', '<td>' + (file.size / 1014).toFixed(1) + 'kb</td>', '<td>等待上传</td>', '<td>', '<button class="layui-btn layui-btn-xs demo-reload layui-hide">重传</button>', '<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>', '</td>', '</tr>'].join(''));

                        }else {
                            var tr = $(['<tr id="upload-' + index + '">', '<td>' + file.name + '</td>', '<td><video controls style="width: 100px;height: 100px;"><source src="' + result + '" type="video/mp4"></video></td>', '<td>' + (file.size / 1014).toFixed(1) + 'kb</td>', '<td>等待上传</td>', '<td>', '<button class="layui-btn layui-btn-xs demo-reload layui-hide">重传</button>', '<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>', '</td>', '</tr>'].join(''));

                        }
                        // 单个上传
                        tr.find('.demo-reload').on('click', function() {
                            obj.upload(index, file);
                            $("#upload-" + index).find("td").eq(2).html((file.size / 1014).toFixed(1) + 'kb');
                        });

                        //删除
                        tr.find('.demo-delete').on('click', function() {
                            delete files[index]; //删除对应的文件
                            tr.remove();
                            uploadListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
                        });

                        demoListView.append(tr);
                        $(".num_pic").text("总共【" + demoListView.find("tr").length + "】张图片");
                    });
                },

                done: function(res, index, upload) {
                    if(res.code == 200) { //上传成功
                        $("#cao").text("地址");
                        var tr = demoListView.find('tr#upload-' + index),
                            tds = tr.children();
                        tds.eq(3).html('<span style="color: #5FB878;">上传成功</span>');
                        tds.eq(4).html('<input type="text" name="files[]"  value="' + res.data + '" class="layui-input" />'); //清空操作
                        return delete this.files[index]; //删除文件队列已经上传成功的文件
                    }
                    this.error(index, upload);
                },
                allDone: function(obj) { //当文件全部被提交后，才触发
                    layer.msg("上传文件数量：【" + obj.total + "】张，上传成功：【" + obj.successful + "】张，失败：【" + obj.aborted + "】", {
                        time: 3000
                    });
                    console.log(obj.total); //得到总文件数
                    console.log(obj.successful); //请求成功的文件数
                    console.log(obj.aborted); //请求失败的文件数
                },
                error: function(index, upload) {
                    var tr = demoListView.find('tr#upload-' + index),
                        tds = tr.children();
                    tds.eq(2).html('<span style="color: #FF5722;">上传失败</span>');
                    tds.eq(4).find('.demo-reload').removeClass('layui-hide'); //显示重传
                }
            });

    });
</script>
<script type="text/javascript">
    layui.use('upload', function() {
        var $ = layui.jquery,
            upload = layui.upload;
        //多文件列表示例
        var demoListView = $('#demoListb'),
            uploadListIns = upload.render({
                elem: '#testListb',
                url: "/vuploads",
                accept: 'file',
                // acceptMime: 'image/*',
                size: 81920,
                multiple: true,
                number: 400,
                auto: false,
                // exts: 'jpg|png|jpeg|gif',
                bindAction: '#testListActionb',
                choose: function(obj) {
                    var files = this.files = obj.pushFile(); //将每次选择的文件追加到文件队列
                    //读取本地文件
                    obj.preview(function(index, file, result) {
                        var is_image = /jpg|png|jpeg|gif/.test(file.name.substring(file.name.indexOf('.')+1));
                        if(is_image){
                            var tr = $(['<tr id="uploadb-' + index + '">', '<td>' + file.name + '</td>', '<td><img src="' + result + '" alt="' + file.name + '" style="width: 100px;height: 100px;"></td>', '<td>' + (file.size / 1014).toFixed(1) + 'kb</td>', '<td>等待上传</td>', '<td>', '<button class="layui-btn layui-btn-xs demo-reloadb layui-hide">重传</button>', '<button class="layui-btn layui-btn-xs layui-btn-danger demo-deleteb">删除</button>', '</td>', '</tr>'].join(''));
                        }else {
                            var tr = $(['<tr id="uploadb-' + index + '">', '<td>' + file.name + '</td>', '<td><video controls style="width: 100px;height: 100px;"><source src="' + result + '" type="video/mp4"></video></td>', '<td>' + (file.size / 1014).toFixed(1) + 'kb</td>', '<td>等待上传</td>', '<td>', '<button class="layui-btn layui-btn-xs demo-reloadb layui-hide">重传</button>', '<button class="layui-btn layui-btn-xs layui-btn-danger demo-deleteb">删除</button>', '</td>', '</tr>'].join(''));

                        }

                        // 单个上传
                        tr.find('.demo-reloadb').on('click', function() {
                            obj.upload(index, file);
                            $("#uploadb-" + index).find("td").eq(2).html((file.size / 1014).toFixed(1) + 'kb');
                        });

                        //删除
                        tr.find('.demo-deleteb').on('click', function() {
                            delete files[index]; //删除对应的文件
                            tr.remove();
                            uploadListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
                        });

                        demoListView.append(tr);
                        $(".num_picb").text("总共【" + demoListView.find("tr").length + "】张图片");
                    });
                },

                done: function(res, index, upload) {
                    if(res.code == 200) { //上传成功
                        $("#cao").text("地址");
                        var tr = demoListView.find('tr#uploadb-' + index),
                            tds = tr.children();
                        tds.eq(3).html('<span style="color: #5FB878;">上传成功</span>');
                        tds.eq(4).html('<input type="text" name="filesb[]"  value="' + res.data + '" class="layui-input" />'); //清空操作
                        return delete this.files[index]; //删除文件队列已经上传成功的文件
                    }
                    this.error(index, upload);
                },
                allDone: function(obj) { //当文件全部被提交后，才触发
                    layer.msg("上传文件数量：【" + obj.total + "】张，上传成功：【" + obj.successful + "】张，失败：【" + obj.aborted + "】", {
                        time: 3000
                    });
                    console.log(obj.total); //得到总文件数
                    console.log(obj.successful); //请求成功的文件数
                    console.log(obj.aborted); //请求失败的文件数
                },
                error: function(index, upload) {
                    var tr = demoListView.find('tr#uploadb-' + index),
                        tds = tr.children();
                    tds.eq(2).html('<span style="color: #FF5722;">上传失败</span>');
                    tds.eq(4).find('.demo-reloadb').removeClass('layui-hide'); //显示重传
                }
            });

    });
</script>

<script>
    // 批量修改
    layui.use('form',function(){
        var form = layui.form;
        $('.checkAll').click(function(){

            $(this).parents('table').find('.checkbox').prop('checked',true);
            form.render();
        })
        $('.cancelAll').click(function(){

            $(this).parents('table').find('.checkbox').prop('checked',false);
            form.render();
        })

        $('.deleteAll').click(function () {
            deleteImgArr = new Array();
            obj = $(this);

            $.each($(this).parents('table').find('.checkbox'),function(){
                if($(this).is(':checked')){
                    deleteImgArr.push($(this).attr('data-src'));
                }
            })

            if(deleteImgArr.length > 0){
                var img_html = ``;
                for(var i in deleteImgArr){
                    img_html+=`<img style="width:200px;" src="`+deleteImgArr[i]+`" alt="">`;
                }

                layer.confirm('确定删除这几张图片<br>'+img_html,{icon: 3, title:'提示',area: ['1000px', '500px']},function(index){
                    //图片批量删除
                    $.ajax({
                        type:'POST',
                        url:'{:url("backend/User/delAllImg")}',
                        // url:'/vdeleteimg',
                        data:{dir:deleteImgArr},
                        success:function(data){

                            if(data.code = 200){

                                $.each(obj.parents('table').find('.checkbox'),function(){
                                    if($(this).is(':checked')){
                                        $("."+$(this).attr('data-key')).remove();
                                        $("."+$(this).attr('data-key')).val('');
                                    }
                                })
                                // $(".deleteimgremove{$key+1}").remove();
                                // $(".deleteimgremove{$key+1}").val('');
                                layer.msg('删除成功',{time:1500,icon:1});
                            }else{
                                console.log(data.message);
                            }
                        },
                        erroe:function () {
                            alert('异常!!');
                        }
                    })
                })

            }else{
                layer.msg('请先选择几张图片吧~',{time:1500,icon:5});
            }

        })
    })

</script>
</body>

</html>
